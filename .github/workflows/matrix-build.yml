name: Matrix Build with Artifacts

on:
  push:
    branches:
      - master
      - main
  workflow_dispatch:

jobs:
  build-and-upload:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: matrix-040654e
        id: matrix-040654e
        run: echo "Starting build for OS: ${{ matrix.os }}"

      - name: Generate build artifact (cross-platform)
        run: |
          python - <<'PY'
          import os
          variant = os.getenv('RUNNER_OS') or '${{ matrix.os }}'
          content = f'Build output for variant: {variant}\nMatrix: ${{ matrix.os }}\n'
          with open('build-output.txt','w', encoding='utf-8') as f:
              f.write(content)
          print('WROTE', len(content), 'bytes')
          PY

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-040654e-${{ matrix.os }}
          path: build-output.txt
